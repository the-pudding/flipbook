import{s as X,p as J,f as L,H as Y,a as F,l as S,g as C,h as P,r as Z,d as x,c as D,m as A,j as E,i as T,v as y,D as N,L as ee,n as K,O as H,u as $,G as te}from"./scheduler.da91aed2.js";import{S as ne,i as re,f as se,b as ie,d as oe,m as ae,a as le,t as he,e as fe}from"./index.91142c57.js";import{C as ue}from"./version.1e3b8813.js";function ce(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}function I(c){throw new Error('Could not dynamically require "'+c+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Q={exports:{}};(function(c,f){(function(u){c.exports=u()})(function(){return function u(w,v,s){function h(p,t){if(!v[p]){if(!w[p]){var o=typeof I=="function"&&I;if(!t&&o)return o(p,!0);if(g)return g(p,!0);var i=new Error("Cannot find module '"+p+"'");throw i.code="MODULE_NOT_FOUND",i}var d=v[p]={exports:{}};w[p][0].call(d.exports,function(_){var a=w[p][1][_];return h(a||_)},d,d.exports,u,w,v,s)}return v[p].exports}for(var g=typeof I=="function"&&I,m=0;m<s.length;m++)h(s[m]);return h}({1:[function(u,w,v){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}w.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(t){if(!g(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},s.prototype.emit=function(t){var o,i,d,_,a,e;if(this._events||(this._events={}),t==="error"&&(!this._events.error||m(this._events.error)&&!this._events.error.length)){if(o=arguments[1],o instanceof Error)throw o;var n=new Error('Uncaught, unspecified "error" event. ('+o+")");throw n.context=o,n}if(i=this._events[t],p(i))return!1;if(h(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:_=Array.prototype.slice.call(arguments,1),i.apply(this,_)}else if(m(i))for(_=Array.prototype.slice.call(arguments,1),e=i.slice(),d=e.length,a=0;a<d;a++)e[a].apply(this,_);return!0},s.prototype.addListener=function(t,o){var i;if(!h(o))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,h(o.listener)?o.listener:o),this._events[t]?m(this._events[t])?this._events[t].push(o):this._events[t]=[this._events[t],o]:this._events[t]=o,m(this._events[t])&&!this._events[t].warned&&(p(this._maxListeners)?i=s.defaultMaxListeners:i=this._maxListeners,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),typeof console.trace=="function"&&console.trace())),this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(t,o){if(!h(o))throw TypeError("listener must be a function");var i=!1;function d(){this.removeListener(t,d),i||(i=!0,o.apply(this,arguments))}return d.listener=o,this.on(t,d),this},s.prototype.removeListener=function(t,o){var i,d,_,a;if(!h(o))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(i=this._events[t],_=i.length,d=-1,i===o||h(i.listener)&&i.listener===o)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,o);else if(m(i)){for(a=_;a-- >0;)if(i[a]===o||i[a].listener&&i[a].listener===o){d=a;break}if(d<0)return this;i.length===1?(i.length=0,delete this._events[t]):i.splice(d,1),this._events.removeListener&&this.emit("removeListener",t,o)}return this},s.prototype.removeAllListeners=function(t){var o,i;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[t]&&delete this._events[t],this;if(arguments.length===0){for(o in this._events)o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[t],h(i))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},s.prototype.listeners=function(t){var o;return!this._events||!this._events[t]?o=[]:h(this._events[t])?o=[this._events[t]]:o=this._events[t].slice(),o},s.prototype.listenerCount=function(t){if(this._events){var o=this._events[t];if(h(o))return 1;if(o)return o.length}return 0},s.listenerCount=function(t,o){return t.listenerCount(o)};function h(t){return typeof t=="function"}function g(t){return typeof t=="number"}function m(t){return typeof t=="object"&&t!==null}function p(t){return t===void 0}},{}],2:[function(u,w,v){var s,h,g,m,p;p=navigator.userAgent.toLowerCase(),m=navigator.platform.toLowerCase(),s=p.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],g=s[1]==="ie"&&document.documentMode,h={name:s[1]==="version"?s[3]:s[1],version:g||parseFloat(s[1]==="opera"&&s[4]?s[4]:s[2]),platform:{name:p.match(/ip(?:ad|od|hone)/)?"ios":(p.match(/(?:webos|android)/)||m.match(/mac|win|linux/)||["other"])[0]}},h[h.name]=!0,h[h.name+parseInt(h.version,10)]=!0,h.platform[h.platform.name]=!0,w.exports=h},{}],3:[function(u,w,v){var s,h,g,m=function(i,d){for(var _ in d)p.call(d,_)&&(i[_]=d[_]);function a(){this.constructor=i}return a.prototype=d.prototype,i.prototype=new a,i.__super__=d.prototype,i},p={}.hasOwnProperty,t=[].indexOf||function(i){for(var d=0,_=this.length;d<_;d++)if(d in this&&this[d]===i)return d;return-1},o=[].slice;s=u("events").EventEmitter,g=u("./browser.coffee"),h=function(i){var d,_;m(a,i),d={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},_={delay:500,copy:!1};function a(e){var n,r,l;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(e);for(r in d)l=d[r],(n=this.options)[r]==null&&(n[r]=l)}return a.prototype.setOption=function(e,n){if(this.options[e]=n,this._canvas!=null&&(e==="width"||e==="height"))return this._canvas[e]=n},a.prototype.setOptions=function(e){var n,r,l;r=[];for(n in e)p.call(e,n)&&(l=e[n],r.push(this.setOption(n,l)));return r},a.prototype.addFrame=function(e,n){var r,l;n==null&&(n={}),r={},r.transparent=this.options.transparent;for(l in _)r[l]=n[l]||_[l];if(this.options.width==null&&this.setOption("width",e.width),this.options.height==null&&this.setOption("height",e.height),typeof ImageData<"u"&&ImageData!==null&&e instanceof ImageData)r.data=e.data;else if(typeof CanvasRenderingContext2D<"u"&&CanvasRenderingContext2D!==null&&e instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext<"u"&&WebGLRenderingContext!==null&&e instanceof WebGLRenderingContext)n.copy?r.data=this.getContextData(e):r.context=e;else if(e.childNodes!=null)n.copy?r.data=this.getImageData(e):r.image=e;else throw new Error("Invalid image");return this.frames.push(r)},a.prototype.render=function(){var e,n,r;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=(function(){var l,b,k;for(k=[],l=0,b=this.frames.length;0<=b?l<b:l>b;0<=b?++l:--l)k.push(null);return k}).call(this),n=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(e=0,r=n;0<=r?e<r:e>r;0<=r?++e:--e)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},a.prototype.abort=function(){for(var e;e=this.activeWorkers.shift(),e!=null;)this.log("killing active worker"),e.terminate();return this.running=!1,this.emit("abort")},a.prototype.spawnWorkers=function(){var e,n,r;return e=Math.min(this.options.workers,this.frames.length),(function(){r=[];for(var l=n=this.freeWorkers.length;n<=e?l<e:l>e;n<=e?l++:l--)r.push(l);return r}).apply(this).forEach(function(l){return function(b){var k;return l.log("spawning worker "+b),k=new Worker(l.options.workerScript),k.onmessage=function(O){return l.activeWorkers.splice(l.activeWorkers.indexOf(k),1),l.freeWorkers.push(k),l.frameFinished(O.data)},l.freeWorkers.push(k)}}(this)),e},a.prototype.frameFinished=function(e){var n,r;if(this.log("frame "+e.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[e.index]=e,this.options.globalPalette===!0&&(this.options.globalPalette=e.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(n=1,r=this.freeWorkers.length;1<=r?n<r:n>r;1<=r?++n:--n)this.renderNextFrame();return t.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},a.prototype.finishRendering=function(){var e,n,r,l,b,k,O,W,j,G,z,R,B,M,q,U;for(W=0,M=this.imageParts,b=0,j=M.length;b<j;b++)n=M[b],W+=(n.data.length-1)*n.pageSize+n.cursor;for(W+=n.pageSize-n.cursor,this.log("rendering finished - filesize "+Math.round(W/1e3)+"kb"),e=new Uint8Array(W),R=0,q=this.imageParts,k=0,G=q.length;k<G;k++)for(n=q[k],U=n.data,r=O=0,z=U.length;O<z;r=++O)B=U[r],e.set(B,R),r===n.data.length-1?R+=n.cursor:R+=n.pageSize;return l=new Blob([e],{type:"image/gif"}),this.emit("finished",l,e)},a.prototype.renderNextFrame=function(){var e,n,r;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return e=this.frames[this.nextFrame++],r=this.freeWorkers.shift(),n=this.getTask(e),this.log("starting frame "+(n.index+1)+" of "+this.frames.length),this.activeWorkers.push(r),r.postMessage(n)},a.prototype.getContextData=function(e){return e.getImageData(0,0,this.options.width,this.options.height).data},a.prototype.getImageData=function(e){var n;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),n=this._canvas.getContext("2d"),n.setFill=this.options.background,n.fillRect(0,0,this.options.width,this.options.height),n.drawImage(e,0,0),this.getContextData(n)},a.prototype.getTask=function(e){var n,r;if(n=this.frames.indexOf(e),r={index:n,last:n===this.frames.length-1,delay:e.delay,transparent:e.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:g.name==="chrome"},e.data!=null)r.data=e.data;else if(e.context!=null)r.data=this.getContextData(e.context);else if(e.image!=null)r.data=this.getImageData(e.image);else throw new Error("Invalid frame");return r},a.prototype.log=function(){var e;if(e=1<=arguments.length?o.call(arguments,0):[],!!this.options.debug)return console.log.apply(console,e)},a}(s),w.exports=h},{"./browser.coffee":2,events:1}]},{},[3])(3)})})(Q);var pe=Q.exports;const de=ce(pe),me=12,ge=Math.floor(1e3/me);async function ve(c,f){const u=new Path2D(f);c.strokeStyle="#000",c.lineWidth=4,c.lineCap="round",c.stroke(u)}async function _e({frames:c,width:f,height:u}){return new Promise(async(w,v)=>{const s=navigator.hardwareConcurrency||4,h=Math.max(2,s/2),g=new de({workers:h,workerScript:"assets/gif.worker.js",quality:1,width:f,height:u}),m=document.createElement("canvas"),p=m.getContext("2d");m.width=f,m.height=u;for(const t of c)p.clearRect(0,0,f,u),p.fillStyle="#fff",p.fillRect(0,0,f,u),await ve(p,t),g.addFrame(p,{copy:!0,delay:ge});g.on("finished",t=>{w(URL.createObjectURL(t))}),g.on("error",()=>{console.log(error),v("Error rendering gif")}),g.render()})}function we(c){let f,u,w="Add",v,s,h="Delete",g,m,p=c[5]?"Stop":"Play",t,o,i,d;return{c(){f=L("div"),u=L("button"),u.textContent=w,v=F(),s=L("button"),s.textContent=h,g=F(),m=L("button"),t=S(p),o=S(" Preview"),this.h()},l(_){f=C(_,"DIV",{slot:!0});var a=P(f);u=C(a,"BUTTON",{"data-svelte-h":!0}),$(u)!=="svelte-axzui1"&&(u.textContent=w),v=D(a),s=C(a,"BUTTON",{"data-svelte-h":!0}),$(s)!=="svelte-192yqoj"&&(s.textContent=h),g=D(a),m=C(a,"BUTTON",{});var e=P(m);t=A(e,p),o=A(e," Preview"),e.forEach(x),a.forEach(x),this.h()},h(){E(f,"slot","ui")},m(_,a){T(_,f,a),y(f,u),y(f,v),y(f,s),y(f,g),y(f,m),y(m,t),y(m,o),i||(d=[N(u,"click",c[6]),N(s,"click",c[7]),N(m,"click",c[8])],i=!0)},p(_,a){a&32&&p!==(p=_[5]?"Stop":"Play")&&K(t,p)},d(_){_&&x(f),i=!1,te(d)}}}function V(c){let f,u,w,v,s;return{c(){f=L("a"),u=S("Download"),w=F(),v=L("img"),this.h()},l(h){f=C(h,"A",{class:!0,href:!0,download:!0});var g=P(f);u=A(g,"Download"),g.forEach(x),w=D(h),v=C(h,"IMG",{src:!0,alt:!0}),this.h()},h(){E(f,"class","btn"),E(f,"href",c[3]),E(f,"download","animation.gif"),H(v.src,s=c[3])||E(v,"src",s),E(v,"alt","animation")},m(h,g){T(h,f,g),y(f,u),T(h,w,g),T(h,v,g)},p(h,g){g&8&&E(f,"href",h[3]),g&8&&!H(v.src,s=h[3])&&E(v,"src",s)},d(h){h&&(x(f),x(w),x(v))}}}function be(c){let f,u,w,v,s,h,g,m,p=c[4]?"Rendering Animation":"Share Animation",t,o,i,d,_;function a(r){c[11](r)}let e={$$slots:{ui:[we]},$$scope:{ctx:c}};c[2]!==void 0&&(e.paths=c[2]),s=new ue({props:e}),c[10](s),J.push(()=>se(s,"paths",a));let n=c[3]&&V(c);return{c(){f=L("section"),u=L("p"),w=new Y(!1),v=F(),ie(s.$$.fragment),g=F(),m=L("button"),t=S(p),o=F(),n&&n.c(),this.h()},l(r){f=C(r,"SECTION",{id:!0});var l=P(f);u=C(l,"P",{});var b=P(u);w=Z(b,!1),b.forEach(x),v=D(l),oe(s.$$.fragment,l),g=D(l),m=C(l,"BUTTON",{});var k=P(m);t=A(k,p),k.forEach(x),o=D(l),n&&n.l(l),l.forEach(x),this.h()},h(){w.a=null,m.disabled=c[4],E(f,"id","playground")},m(r,l){T(r,f,l),y(f,u),w.m(c[0],u),y(f,v),ae(s,f,null),y(f,g),y(f,m),y(m,t),y(f,o),n&&n.m(f,null),i=!0,d||(_=N(m,"click",c[9]),d=!0)},p(r,[l]){(!i||l&1)&&w.p(r[0]);const b={};l&4128&&(b.$$scope={dirty:l,ctx:r}),!h&&l&4&&(h=!0,b.paths=r[2],ee(()=>h=!1)),s.$set(b),(!i||l&16)&&p!==(p=r[4]?"Rendering Animation":"Share Animation")&&K(t,p),(!i||l&16)&&(m.disabled=r[4]),r[3]?n?n.p(r,l):(n=V(r),n.c(),n.m(f,null)):n&&(n.d(1),n=null)},i(r){i||(le(s.$$.fragment,r),i=!0)},o(r){he(s.$$.fragment,r),i=!1},d(r){r&&x(f),c[10](null),fe(s),n&&n.d(),d=!1,_()}}}function ke(c,f,u){let{text:w="Make an animation!"}=f,v,s,h,g,m;function p(){v.addFrame()}function t(){v.deleteFrame()}function o(){v.preview(),u(5,m=!m)}async function i(){u(4,g=!0),u(3,h=await _e({frames:s,width:300,height:300})),u(4,g=!1)}function d(a){J[a?"unshift":"push"](()=>{v=a,u(1,v)})}function _(a){s=a,u(2,s)}return c.$$set=a=>{"text"in a&&u(0,w=a.text)},[w,v,s,h,g,m,p,t,o,i,d,_]}class Le extends ne{constructor(f){super(),re(this,f,ke,be,X,{text:0})}}export{Le as P};
