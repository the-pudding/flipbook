import{s as X,f as C,g as S,h as F,d as D,i as M,u as Q,M as Z,N as tt,z as et,t as st,p as K,j as P,r as B,O as it,l as at,m as rt,w as E,n as nt,a as ot,x as H,c as ht,y as J,G as lt}from"./scheduler.1b8758cb.js";import{S as _t,i as ct,g as ut,t as G,c as dt,a as z,f as pt,b as ft,d as gt,m as mt,e as bt}from"./index.1f7cc648.js";import{a as vt,C as wt}from"./version.08d7136c.js";import"./paths.0e95bec1.js";import{u as Y}from"./misc.df026797.js";async function It(_,t){const r=`https://pudding-flipbook-server-5a76bc9eb168.herokuapp.com//${_}`,u="";try{const l=Date.now(),a=JSON.stringify(t),m=await(await fetch(r,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-Pudding-Token":u},credentials:"include",body:a})).json(),I=`${Date.now()-l}ms`;return{...m,duration:I}}catch(l){throw console.log(l==null?void 0:l.message),l}}var W={exports:{}};(function(_){var t=(()=>{var e=Object.defineProperty,r=Object.getOwnPropertyDescriptor,u=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,o=(n,h,p)=>h in n?e(n,h,{enumerable:!0,configurable:!0,writable:!0,value:p}):n[h]=p,m=(n,h)=>{for(var p in h||(h={}))a.call(h,p)&&o(n,p,h[p]);if(l)for(var p of l(h))f.call(h,p)&&o(n,p,h[p]);return n},b=(n,h)=>{for(var p in h)e(n,p,{get:h[p],enumerable:!0})},I=(n,h,p,O)=>{if(h&&typeof h=="object"||typeof h=="function")for(let y of u(h))!a.call(n,y)&&y!==p&&e(n,y,{get:()=>h[y],enumerable:!(O=r(h,y))||O.enumerable});return n},U=n=>I(e({},"__esModule",{value:!0}),n),s=(n,h,p)=>(o(n,typeof h!="symbol"?h+"":h,p),p),j={};b(j,{DEFAULT_OPTIONS:()=>k,DEFAULT_UUID_LENGTH:()=>q,default:()=>A});var N="5.0.3",q=6,k={dictionary:"alphanum",shuffle:!0,debug:!1,length:q,counter:0},T=class{constructor(h={}){s(this,"counter"),s(this,"debug"),s(this,"dict"),s(this,"version"),s(this,"dictIndex",0),s(this,"dictRange",[]),s(this,"lowerBound",0),s(this,"upperBound",0),s(this,"dictLength",0),s(this,"uuidLength"),s(this,"_digit_first_ascii",48),s(this,"_digit_last_ascii",58),s(this,"_alpha_lower_first_ascii",97),s(this,"_alpha_lower_last_ascii",123),s(this,"_hex_last_ascii",103),s(this,"_alpha_upper_first_ascii",65),s(this,"_alpha_upper_last_ascii",91),s(this,"_number_dict_ranges",{digits:[this._digit_first_ascii,this._digit_last_ascii]}),s(this,"_alpha_dict_ranges",{lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii],upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]}),s(this,"_alpha_lower_dict_ranges",{lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii]}),s(this,"_alpha_upper_dict_ranges",{upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]}),s(this,"_alphanum_dict_ranges",{digits:[this._digit_first_ascii,this._digit_last_ascii],lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii],upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]}),s(this,"_alphanum_lower_dict_ranges",{digits:[this._digit_first_ascii,this._digit_last_ascii],lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii]}),s(this,"_alphanum_upper_dict_ranges",{digits:[this._digit_first_ascii,this._digit_last_ascii],upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]}),s(this,"_hex_dict_ranges",{decDigits:[this._digit_first_ascii,this._digit_last_ascii],alphaDigits:[this._alpha_lower_first_ascii,this._hex_last_ascii]}),s(this,"_dict_ranges",{_number_dict_ranges:this._number_dict_ranges,_alpha_dict_ranges:this._alpha_dict_ranges,_alpha_lower_dict_ranges:this._alpha_lower_dict_ranges,_alpha_upper_dict_ranges:this._alpha_upper_dict_ranges,_alphanum_dict_ranges:this._alphanum_dict_ranges,_alphanum_lower_dict_ranges:this._alphanum_lower_dict_ranges,_alphanum_upper_dict_ranges:this._alphanum_upper_dict_ranges,_hex_dict_ranges:this._hex_dict_ranges}),s(this,"log",(...i)=>{const c=[...i];if(c[0]=`[short-unique-id] ${i[0]}`,this.debug===!0&&typeof console<"u"&&console!==null)return console.log(...c)}),s(this,"setDictionary",(i,c)=>{let d;if(i&&Array.isArray(i)&&i.length>1)d=i;else{d=[];let g;this.dictIndex=g=0;const w=`_${i}_dict_ranges`,v=this._dict_ranges[w];Object.keys(v).forEach(x=>{const V=x;for(this.dictRange=v[V],this.lowerBound=this.dictRange[0],this.upperBound=this.dictRange[1],this.dictIndex=g=this.lowerBound;this.lowerBound<=this.upperBound?g<this.upperBound:g>this.upperBound;this.dictIndex=this.lowerBound<=this.upperBound?g+=1:g-=1)d.push(String.fromCharCode(this.dictIndex))})}c&&(d=d.sort(()=>Math.random()-.5)),this.dict=d,this.dictLength=this.dict.length,this.setCounter(0)}),s(this,"seq",()=>this.sequentialUUID()),s(this,"sequentialUUID",()=>{let i,c,d="";i=this.counter;do c=i%this.dictLength,i=Math.trunc(i/this.dictLength),d+=this.dict[c];while(i!==0);return this.counter+=1,d}),s(this,"rnd",(i=this.uuidLength||q)=>this.randomUUID(i)),s(this,"randomUUID",(i=this.uuidLength||q)=>{let c,d,g;if(i===null||typeof i>"u"||i<1)throw new Error("Invalid UUID Length Provided");for(c="",g=0;g<i;g+=1)d=parseInt((Math.random()*this.dictLength).toFixed(0),10)%this.dictLength,c+=this.dict[d];return c}),s(this,"fmt",(i,c)=>this.formattedUUID(i,c)),s(this,"formattedUUID",(i,c)=>{const d={$r:this.randomUUID,$s:this.sequentialUUID,$t:this.stamp};return i.replace(/\$[rs]\d{0,}|\$t0|\$t[1-9]\d{1,}/g,w=>{const v=w.slice(0,2),x=parseInt(w.slice(2),10);return v==="$s"?d[v]().padStart(x,"0"):v==="$t"&&c?d[v](x,c):d[v](x)})}),s(this,"availableUUIDs",(i=this.uuidLength)=>parseFloat(Math.pow([...new Set(this.dict)].length,i).toFixed(0))),s(this,"approxMaxBeforeCollision",(i=this.availableUUIDs(this.uuidLength))=>parseFloat(Math.sqrt(Math.PI/2*i).toFixed(20))),s(this,"collisionProbability",(i=this.availableUUIDs(this.uuidLength),c=this.uuidLength)=>parseFloat((this.approxMaxBeforeCollision(i)/this.availableUUIDs(c)).toFixed(20))),s(this,"uniqueness",(i=this.availableUUIDs(this.uuidLength))=>{const c=parseFloat((1-this.approxMaxBeforeCollision(i)/i).toFixed(20));return c>1?1:c<0?0:c}),s(this,"getVersion",()=>this.version),s(this,"stamp",(i,c)=>{const d=Math.floor(+(c||new Date)/1e3).toString(16);if(typeof i=="number"&&i===0)return d;if(typeof i!="number"||i<10)throw new Error(["Param finalLength must be a number greater than or equal to 10,","or 0 if you want the raw hexadecimal timestamp"].join(`
`));const g=i-9,w=Math.round(Math.random()*(g>15?15:g)),v=this.randomUUID(g);return`${v.substring(0,w)}${d}${v.substring(w)}${w.toString(16)}`}),s(this,"parseStamp",(i,c)=>{if(c&&!/t0|t[1-9]\d{1,}/.test(c))throw new Error("Cannot extract date from a formated UUID with no timestamp in the format");const d=c?c.replace(/\$[rs]\d{0,}|\$t0|\$t[1-9]\d{1,}/g,w=>{const v={$r:L=>[...Array(L)].map(()=>"r").join(""),$s:L=>[...Array(L)].map(()=>"s").join(""),$t:L=>[...Array(L)].map(()=>"t").join("")},x=w.slice(0,2),V=parseInt(w.slice(2),10);return v[x](V)}).replace(/^(.*?)(t{8,})(.*)$/g,(w,v,x)=>i.substring(v.length,v.length+x.length)):i;if(d.length===8)return new Date(parseInt(d,16)*1e3);if(d.length<10)throw new Error("Stamp length invalid");const g=parseInt(d.substring(d.length-1),16);return new Date(parseInt(d.substring(g,g+8),16)*1e3)}),s(this,"setCounter",i=>{this.counter=i});const p=m(m({},k),h);this.counter=0,this.debug=!1,this.dict=[],this.version=N;const{dictionary:O,shuffle:y,length:$,counter:R}=p;return this.uuidLength=$,this.setDictionary(O,y),this.setCounter(R),this.debug=p.debug,this.log(this.dict),this.log(`Generator instantiated with Dictionary Size ${this.dictLength} and counter set to ${this.counter}`),this.log=this.log.bind(this),this.setDictionary=this.setDictionary.bind(this),this.setCounter=this.setCounter.bind(this),this.seq=this.seq.bind(this),this.sequentialUUID=this.sequentialUUID.bind(this),this.rnd=this.rnd.bind(this),this.randomUUID=this.randomUUID.bind(this),this.fmt=this.fmt.bind(this),this.formattedUUID=this.formattedUUID.bind(this),this.availableUUIDs=this.availableUUIDs.bind(this),this.approxMaxBeforeCollision=this.approxMaxBeforeCollision.bind(this),this.collisionProbability=this.collisionProbability.bind(this),this.uniqueness=this.uniqueness.bind(this),this.getVersion=this.getVersion.bind(this),this.stamp=this.stamp.bind(this),this.parseStamp=this.parseStamp.bind(this),this}};s(T,"default",T);var A=T;return U(j)})();_.exports=t.default,typeof window<"u"&&(t=t.default)})(W);var Ut=W.exports;const Dt=vt(Ut),yt=new Dt({length:12});function Mt(){return yt.rnd()}function xt(_){let t;return{c(){t=C("div"),this.h()},l(e){t=S(e,"DIV",{class:!0}),F(t).forEach(D),this.h()},h(){P(t,"class","spacer svelte-hqfb9c")},m(e,r){M(e,t,r)},p:B,i:B,o:B,d(e){e&&D(t)}}}function Ct(_){let t,e,r;function u(a){_[11](a)}let l={preset:_[1],$$slots:{ui:[Pt]},$$scope:{ctx:_}};return _[0]!==void 0&&(l.path=_[0]),t=new wt({props:l}),_[10](t),K.push(()=>pt(t,"path",u)),t.$on("validate",_[6]),{c(){ft(t.$$.fragment)},l(a){gt(t.$$.fragment,a)},m(a,f){mt(t,a,f),r=!0},p(a,f){const o={};f&2&&(o.preset=a[1]),f&1048576&&(o.$$scope={dirty:f,ctx:a}),!e&&f&1&&(e=!0,o.path=a[0],it(()=>e=!1)),t.$set(o)},i(a){r||(z(t.$$.fragment,a),r=!0)},o(a){G(t.$$.fragment,a),r=!1},d(a){_[10](null),bt(t,a)}}}function St(_){let t,e,r;return{c(){t=C("p"),e=C("strong"),r=at(_[2]),this.h()},l(u){t=S(u,"P",{class:!0});var l=F(t);e=S(l,"STRONG",{});var a=F(e);r=rt(a,_[2]),a.forEach(D),l.forEach(D),this.h()},h(){P(t,"class","error")},m(u,l){M(u,t,l),E(t,e),E(e,r)},p(u,l){l&4&&nt(r,u[2])},i:B,o:B,d(u){u&&D(t)}}}function Pt(_){let t,e,r,u="Submit",l,a,f="Clear",o,m;return{c(){t=C("div"),e=C("div"),r=C("button"),r.textContent=u,l=ot(),a=C("button"),a.textContent=f,this.h()},l(b){t=S(b,"DIV",{class:!0,slot:!0});var I=F(t);e=S(I,"DIV",{class:!0});var U=F(e);r=S(U,"BUTTON",{class:!0,"data-svelte-h":!0}),H(r)!=="svelte-1q5e91d"&&(r.textContent=u),l=ht(U),a=S(U,"BUTTON",{class:!0,"data-svelte-h":!0}),H(a)!=="svelte-1ji3cv1"&&(a.textContent=f),U.forEach(D),I.forEach(D),this.h()},h(){P(r,"class","small svelte-hqfb9c"),P(a,"class","small svelte-hqfb9c"),P(e,"class","buttons svelte-hqfb9c"),P(t,"class","ui svelte-hqfb9c"),P(t,"slot","ui")},m(b,I){M(b,t,I),E(t,e),E(e,r),E(e,l),E(e,a),o||(m=[J(r,"click",_[4]),J(a,"click",_[5])],o=!0)},p:B,d(b){b&&D(t),o=!1,lt(m)}}}function qt(_){let t,e,r,u;const l=[St,Ct,xt],a=[];function f(o,m){return o[2]?0:o[1]?1:2}return e=f(_),r=a[e]=l[e](_),{c(){t=C("section"),r.c()},l(o){t=S(o,"SECTION",{});var m=F(t);r.l(m),m.forEach(D)},m(o,m){M(o,t,m),a[e].m(t,null),u=!0},p(o,[m]){let b=e;e=f(o),e===b?a[e].p(o,m):(ut(),G(a[b],1,1,()=>{a[b]=null}),dt(),r=a[e],r?r.p(o,m):(r=a[e]=l[e](o),r.c()),z(r,1),r.m(t,null))},i(o){u||(z(r),u=!0)},o(o){G(r),u=!1},d(o){o&&D(t),a[e].d()}}}const Ot="https://pudding.cool/projects/flipbook-data/drawings";function Et(_,t,e){let r,u;Q(_,Y,n=>e(13,u=n));let{animationId:l}=t,{prevFrameIndex:a}=t,{prevShortcode:f}=t;const o=Z("copy");o.spread,o.url,o.title;const m=tt();let b,I,U,s;function j(){s.addFrame()}function N(){s.resetFrame()}async function q({detail:n}){try{if(n){const h=await It("submit",{userId:u.id,animationId:l,prevShortcode:f,nextFrameIndex:r,drawing:b}),{status:p,message:O,shortcode:y}=h,$=Date.now();if(p===200){const R={animationId:l,nextFrameIndex:r,prevShortcode:f,shortcode:y,timestamp:$},i=[...u.submissions,R];et(Y,u={...u,submissions:i},u),await st(),m("done")}else e(2,U="Sorry! There was an issue submitting your drawing. Please refresh the page or try again later."),console.log({status:p,message:O})}}catch(h){e(2,U="Sorry! There was an issue submitting your drawing. Please refresh the page or try again later."),console.log(h)}}async function k(){try{const n=`${Ot}/${l}/${f}.txt?version=${Date.now()}`,h=await fetch(n);e(1,I=await h.text())}catch(n){e(2,U="Sorry. We had trouble loading the previous drawing. Please try again later."),console.log(n)}}function T(n){K[n?"unshift":"push"](()=>{s=n,e(3,s)})}function A(n){b=n,e(0,b)}return _.$$set=n=>{"animationId"in n&&e(7,l=n.animationId),"prevFrameIndex"in n&&e(8,a=n.prevFrameIndex),"prevShortcode"in n&&e(9,f=n.prevShortcode)},_.$$.update=()=>{_.$$.dirty&256&&(r=a+1),_.$$.dirty&512&&k()},[b,I,U,s,j,N,q,l,a,f,T,A]}class Nt extends _t{constructor(t){super(),ct(this,t,Et,qt,X,{animationId:7,prevFrameIndex:8,prevShortcode:9})}}export{Nt as D,Mt as g,It as s};
